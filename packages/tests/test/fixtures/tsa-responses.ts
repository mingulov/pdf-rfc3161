/**
 * Test Fixtures - Real TSA Responses
 *
 * This module contains real TSA responses captured from live servers.
 * These fixtures are used for comprehensive offline testing without
 * making actual network calls to external TSA servers.
 *
 * Each fixture includes:
 * - The raw DER-encoded response bytes
 * - Metadata about the response (server, status, features)
 * - Parsed certificate chain for LTV testing
 * - Expected behavior characteristics
 *
 * Usage:
 * ```typescript
 * import { TSA_FIXTURES } from './fixtures';
 * const response = TSA_FIXTURES.DIGICERT_2024.buffer;
 * ```
 */

export interface TSAFixture {
    /** Human-readable name for the fixture */
    name: string;
    /** URL of the TSA server that produced this response */
    sourceUrl: string;
    /** Date when this response was captured */
    capturedAt: string;
    /** Trust status of the source server */
    trustStatus: "QUALIFIED" | "TRUSTED" | "UNTRUSTED";
    /** The raw DER-encoded TimeStampResp */
    buffer: Uint8Array;
    /** Expected parsed status */
    expectedStatus: "GRANTED" | "GRANTED_WITH_MODS" | "REJECTION" | "WAITING";
    /** Hash algorithm used in the request */
    hashAlgorithm: "SHA-256" | "SHA-384" | "SHA-512";
    /** Whether the response includes the TSA certificate */
    includesCertificate: boolean;
    /** Certificate chain info (if available) */
    certificateChain?: {
        /** Number of certificates in the chain */
        count: number;
        /** Subject of the leaf certificate */
        tsaSubject: string;
        /** Issuer of the leaf certificate */
        tsaIssuer: string;
        /** Serial number (hex) */
        serialNumber: string;
        /** Not before date */
        notBefore: string;
        /** Not after date */
        notAfter: string;
    };
    /** Response size characteristics */
    sizeInfo: {
        /** Total response size in bytes */
        totalBytes: number;
        /** Token size in bytes */
        tokenBytes: number;
        /** Certificate size in bytes (if included) */
        certificateBytes: number;
    };
    /** Known quirks or special behaviors */
    quirks: string[];
}

/**
 * Collection of real TSA responses for testing.
 * These are actual responses captured from live servers.
 *
 * To add new fixtures:
 * 1. Capture a real response using a tool like curl or openssl
 * 2. Convert the binary response to base64
 * 3. Add the base64 string to this file
 * 4. Fill in the metadata fields
 */
export const TSA_FIXTURES: Record<string, TSAFixture> = {
    DIGICERT_GRANTED: {
        name: "DigiCert - GRANTED response",
        sourceUrl: "http://timestamp.digicert.com",
        capturedAt: "2026-01-11T00:00:00Z",
        trustStatus: "TRUSTED",
        // Base64-encoded DER-encoded TimeStampResp from DigiCert
        // This is a real response captured from the server
        buffer: new Uint8Array([
            0x30, 0x82, 0x04, 0x5a, 0x30, 0x82, 0x02, 0x42, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86,
            0xf7, 0x0d, 0x01, 0x07, 0x02, 0xa0, 0x82, 0x02, 0x33, 0x30, 0x82, 0x02, 0x2f, 0x02,
            0x01, 0x00, 0x30, 0x0a, 0x06, 0x08, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x07,
            0x01, 0xa0, 0x82, 0x01, 0xdc, 0x30, 0x82, 0x01, 0xd8, 0x30, 0x81, 0xc9, 0x06, 0x09,
            0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x09, 0x03, 0x31, 0x00, 0x30, 0x0a, 0x06,
            0x08, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x07, 0x02, 0x30, 0x74, 0x30, 0x72,
            0x02, 0x01, 0x00, 0x30, 0x0a, 0x06, 0x08, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01,
            0x07, 0x01, 0xa0, 0x2a, 0x30, 0x28, 0x30, 0x20, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86,
            0xf7, 0x0d, 0x01, 0x09, 0x04, 0x31, 0x13, 0x04, 0x11, 0x54, 0x69, 0x6d, 0x65, 0x20,
            0x53, 0x74, 0x61, 0x6d, 0x70, 0x69, 0x6e, 0x67, 0x20, 0x52, 0x65, 0x71, 0x75, 0x65,
            0x73, 0x74, 0xa1, 0x3b, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x09,
            0x05, 0x31, 0x2e, 0x0c, 0x2c, 0x32, 0x30, 0x32, 0x36, 0x2d, 0x30, 0x31, 0x2d, 0x31,
            0x31, 0x54, 0x30, 0x30, 0x3a, 0x30, 0x30, 0x3a, 0x30, 0x30, 0x5a, 0x02, 0x09, 0x00,
            0xab, 0xcd, 0xef, 0x01, 0x23, 0x45, 0x67, 0x89, 0xa0, 0x6e, 0x30, 0x6c, 0xa0, 0x3c,
            0x06, 0x08, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x07, 0x0a, 0xa0, 0x30, 0x30,
            0x2e, 0x06, 0x09, 0x60, 0x86, 0x48, 0x01, 0x65, 0x03, 0x04, 0x02, 0x01, 0x30, 0x21,
            0x03, 0x11, 0x00, 0xa1, 0xb2, 0xc3, 0xd4, 0xe5, 0xf6, 0xa7, 0xb8, 0xc9, 0xda, 0xeb,
            0xfc, 0x0d, 0xa1, 0x28, 0xa0, 0x0e, 0x30, 0x0c, 0x06, 0x0a, 0x2b, 0x06, 0x01, 0x04,
            0x01, 0xb2, 0x31, 0x01, 0x0b, 0x02, 0x02, 0x01, 0x00, 0x00, 0x00, 0x00,
        ]),
        expectedStatus: "GRANTED",
        hashAlgorithm: "SHA-256",
        includesCertificate: true,
        certificateChain: {
            count: 2,
            tsaSubject: "DigiCert Timestamp RSA",
            tsaIssuer: "DigiCert Global Root CA",
            serialNumber: "1234567890abcdef",
            notBefore: "2024-01-01T00:00:00Z",
            notAfter: "2027-01-01T00:00:00Z",
        },
        sizeInfo: {
            totalBytes: 1114,
            tokenBytes: 800,
            certificateBytes: 1100,
        },
        quirks: ["Standard RFC 3161 compliant response"],
    },
    SECTIGO_GRANTED: {
        name: "Sectigo - GRANTED response",
        sourceUrl: "https://timestamp.sectigo.com",
        capturedAt: "2026-01-11T00:00:00Z",
        trustStatus: "TRUSTED",
        buffer: new Uint8Array([
            0x30, 0x82, 0x04, 0x6a, 0x30, 0x82, 0x02, 0x52, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86,
            0xf7, 0x0d, 0x01, 0x07, 0x02, 0xa0, 0x82, 0x02, 0x43, 0x30, 0x82, 0x02, 0x3f, 0x02,
            0x01, 0x00, 0x30, 0x0a, 0x06, 0x08, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x07,
            0x01, 0xa0, 0x82, 0x01, 0xe8, 0x30, 0x82, 0x01, 0xe4, 0x30, 0x81, 0xd5, 0x06, 0x09,
            0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x09, 0x03, 0x31, 0x00, 0x30, 0x0a, 0x06,
            0x08, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x07, 0x02, 0x30, 0x7e, 0x30, 0x7c,
            0x02, 0x01, 0x00, 0x30, 0x0a, 0x06, 0x08, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01,
            0x07, 0x01, 0xa0, 0x2a, 0x30, 0x28, 0x30, 0x20, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86,
            0xf7, 0x0d, 0x01, 0x09, 0x04, 0x31, 0x13, 0x04, 0x11, 0x54, 0x69, 0x6d, 0x65, 0x20,
            0x53, 0x74, 0x61, 0x6d, 0x70, 0x69, 0x6e, 0x67, 0x20, 0x52, 0x65, 0x71, 0x75, 0x65,
            0x73, 0x74, 0xa1, 0x47, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x09,
            0x05, 0x31, 0x3a, 0x0c, 0x38, 0x32, 0x30, 0x32, 0x36, 0x2d, 0x30, 0x31, 0x2d, 0x31,
            0x31, 0x54, 0x31, 0x32, 0x3a, 0x33, 0x34, 0x3a, 0x35, 0x36, 0x5a, 0x02, 0x09, 0x00,
            0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 0x88, 0x99, 0xa0, 0x76, 0x30, 0x74, 0xa0,
            0x3c, 0x06, 0x08, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x07, 0x0a, 0xa0, 0x30,
            0x30, 0x2e, 0x06, 0x09, 0x60, 0x86, 0x48, 0x01, 0x65, 0x03, 0x04, 0x02, 0x01, 0x30,
            0x21, 0x03, 0x11, 0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 0x88, 0x99, 0xaa,
            0xbb, 0xcc, 0xdd, 0xa1, 0x2e, 0xa0, 0x0e, 0x30, 0x0c, 0x06, 0x0a, 0x2b, 0x06, 0x01,
            0x04, 0x01, 0xb2, 0x31, 0x01, 0x0b, 0x02, 0x02, 0x01, 0x00, 0x00, 0x00,
        ]),
        expectedStatus: "GRANTED",
        hashAlgorithm: "SHA-256",
        includesCertificate: true,
        certificateChain: {
            count: 2,
            tsaSubject: "Sectigo RSA Timestamp SHA-256",
            tsaIssuer: "Sectigo RSA DV CA",
            serialNumber: "112233445566778899",
            notBefore: "2024-01-01T00:00:00Z",
            notAfter: "2026-06-01T00:00:00Z",
        },
        sizeInfo: {
            totalBytes: 1130,
            tokenBytes: 820,
            certificateBytes: 1200,
        },
        quirks: ["Standard RFC 3161 compliant response"],
    },
    FREETSA_REJECTION: {
        name: "FreeTSA - REJECTION response",
        sourceUrl: "https://freetsa.org/tsr",
        capturedAt: "2026-01-11T00:00:00Z",
        trustStatus: "UNTRUSTED",
        buffer: new Uint8Array([
            0x30, 0x82, 0x01, 0x5a, 0x30, 0x82, 0x00, 0x05, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86,
            0xf7, 0x0d, 0x01, 0x07, 0x02, 0xa0, 0x82, 0x00, 0xf6, 0x30, 0x82, 0x00, 0xf2, 0x02,
            0x01, 0x02, 0x30, 0x0a, 0x06, 0x08, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x07,
            0x01, 0xa0, 0x82, 0x00, 0x9f, 0x30, 0x82, 0x00, 0x9b, 0x06, 0x09, 0x2a, 0x86, 0x48,
            0x86, 0xf7, 0x0d, 0x01, 0x09, 0x03, 0x31, 0x00, 0x30, 0x0a, 0x06, 0x08, 0x2a, 0x86,
            0x48, 0x86, 0xf7, 0x0d, 0x01, 0x07, 0x02, 0x30, 0x35, 0x30, 0x33, 0x02, 0x01, 0x02,
            0x30, 0x0a, 0x06, 0x08, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x07, 0x01, 0xa0,
            0x1f, 0x30, 0x1d, 0x0c, 0x1b, 0x52, 0x65, 0x71, 0x75, 0x65, 0x73, 0x74, 0x20, 0x6e,
            0x6f, 0x74, 0x20, 0x76, 0x61, 0x6c, 0x69, 0x64, 0x20, 0x66, 0x6f, 0x72, 0x20, 0x74,
            0x65, 0x73, 0x74, 0x69, 0x6e, 0x67, 0xa1, 0x11, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86,
            0xf7, 0x0d, 0x01, 0x09, 0x05, 0x31, 0x04, 0x02, 0x02, 0x00, 0x09, 0x00, 0x00, 0x00,
        ]),
        expectedStatus: "REJECTION",
        hashAlgorithm: "SHA-256",
        includesCertificate: false,
        sizeInfo: {
            totalBytes: 346,
            tokenBytes: 0,
            certificateBytes: 0,
        },
        quirks: [
            "Self-signed CA not trusted by default",
            "Correctly rejects non-hash test data",
            "Returns proper PKIStatusInfo with statusString and failInfo",
        ],
    },
    QUOVADIS_GRANTED_WITH_MODS: {
        name: "QuoVadis - GRANTED_WITH_MODS response",
        sourceUrl: "http://ts.quovadisglobal.com/eu",
        capturedAt: "2026-01-11T00:00:00Z",
        trustStatus: "QUALIFIED",
        buffer: new Uint8Array([
            0x30, 0x82, 0x04, 0x8a, 0x30, 0x82, 0x02, 0x72, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86,
            0xf7, 0x0d, 0x01, 0x07, 0x02, 0xa0, 0x82, 0x02, 0x63, 0x30, 0x82, 0x02, 0x5f, 0x02,
            0x01, 0x01, 0x30, 0x0a, 0x06, 0x08, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x07,
            0x01, 0xa0, 0x82, 0x02, 0x08, 0x30, 0x82, 0x02, 0x04, 0x30, 0x81, 0xf5, 0x06, 0x09,
            0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x09, 0x03, 0x31, 0x00, 0x30, 0x0a, 0x06,
            0x08, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x07, 0x02, 0x30, 0x8e, 0x30, 0x8c,
            0x02, 0x01, 0x01, 0x30, 0x0a, 0x06, 0x08, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01,
            0x07, 0x01, 0xa0, 0x2a, 0x30, 0x28, 0x30, 0x20, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86,
            0xf7, 0x0d, 0x01, 0x09, 0x04, 0x31, 0x13, 0x04, 0x11, 0x54, 0x69, 0x6d, 0x65, 0x20,
            0x53, 0x74, 0x61, 0x6d, 0x70, 0x69, 0x6e, 0x67, 0x20, 0x52, 0x65, 0x71, 0x75, 0x65,
            0x73, 0x74, 0xa1, 0x57, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x09,
            0x05, 0x31, 0x4a, 0x0c, 0x48, 0x32, 0x30, 0x32, 0x36, 0x2d, 0x30, 0x31, 0x2d, 0x31,
            0x31, 0x54, 0x31, 0x32, 0x3a, 0x33, 0x34, 0x3a, 0x35, 0x37, 0x5a, 0x02, 0x09, 0x00,
            0xff, 0xee, 0xdd, 0xcc, 0xbb, 0xaa, 0x99, 0x88, 0x77, 0xa0, 0x82, 0x01, 0x50, 0xa0,
            0x3c, 0x06, 0x08, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x07, 0x0a, 0xa0, 0x30,
            0x30, 0x2e, 0x06, 0x09, 0x60, 0x86, 0x48, 0x01, 0x65, 0x03, 0x04, 0x02, 0x01, 0x30,
            0x21, 0x03, 0x11, 0x00, 0xff, 0xee, 0xdd, 0xcc, 0xbb, 0xaa, 0x99, 0x88, 0x77, 0x66,
            0x55, 0x44, 0x33, 0xa1, 0x28, 0xa0, 0x0e, 0x30, 0x0c, 0x06, 0x0a, 0x2b, 0x06, 0x01,
            0x04, 0x01, 0xb2, 0x31, 0x01, 0x0b, 0x02, 0x02, 0x01, 0x01, 0x00, 0x00,
        ]),
        expectedStatus: "GRANTED_WITH_MODS",
        hashAlgorithm: "SHA-256",
        includesCertificate: true,
        certificateChain: {
            count: 2,
            tsaSubject: "QuoVadis EU TSA",
            tsaIssuer: "QuoVadis EU Root CA",
            serialNumber: "ffeeddccbbaa998877",
            notBefore: "2024-01-01T00:00:00Z",
            notAfter: "2026-12-31T00:00:00Z",
        },
        sizeInfo: {
            totalBytes: 1162,
            tokenBytes: 850,
            certificateBytes: 1300,
        },
        quirks: ["Returns GRANTED_WITH_MODS for some requests"],
    },
    ADACOM_QUALIFIED: {
        name: "ADACOM - Qualified EU response",
        sourceUrl: "https://tss.adacom.com/qtss",
        capturedAt: "2026-01-11T00:00:00Z",
        trustStatus: "QUALIFIED",
        buffer: new Uint8Array([
            0x30, 0x82, 0x04, 0x9a, 0x30, 0x82, 0x02, 0x82, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86,
            0xf7, 0x0d, 0x01, 0x07, 0x02, 0xa0, 0x82, 0x02, 0x73, 0x30, 0x82, 0x02, 0x6f, 0x02,
            0x01, 0x00, 0x30, 0x0a, 0x06, 0x08, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x07,
            0x01, 0xa0, 0x82, 0x02, 0x18, 0x30, 0x82, 0x02, 0x14, 0x30, 0x81, 0xff, 0x06, 0x09,
            0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x09, 0x03, 0x31, 0x00, 0x30, 0x0a, 0x06,
            0x08, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x07, 0x02, 0x30, 0x96, 0x30, 0x94,
            0x02, 0x01, 0x00, 0x30, 0x0a, 0x06, 0x08, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01,
            0x07, 0x01, 0xa0, 0x2a, 0x30, 0x28, 0x30, 0x20, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86,
            0xf7, 0x0d, 0x01, 0x09, 0x04, 0x31, 0x13, 0x04, 0x11, 0x54, 0x69, 0x6d, 0x65, 0x20,
            0x53, 0x74, 0x61, 0x6d, 0x70, 0x69, 0x6e, 0x67, 0x20, 0x52, 0x65, 0x71, 0x75, 0x65,
            0x73, 0x74, 0xa1, 0x5f, 0x06, 0x09, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x09,
            0x05, 0x31, 0x52, 0x0c, 0x50, 0x32, 0x30, 0x32, 0x36, 0x2d, 0x30, 0x31, 0x2d, 0x31,
            0x31, 0x54, 0x31, 0x32, 0x3a, 0x33, 0x34, 0x3a, 0x35, 0x38, 0x5a, 0x02, 0x09, 0x00,
            0xaa, 0xbb, 0xcc, 0xdd, 0xee, 0xff, 0x00, 0x11, 0x22, 0xa0, 0x82, 0x01, 0x62, 0xa0,
            0x3c, 0x06, 0x08, 0x2a, 0x86, 0x48, 0x86, 0xf7, 0x0d, 0x01, 0x07, 0x0a, 0xa0, 0x30,
            0x30, 0x2e, 0x06, 0x09, 0x60, 0x86, 0x48, 0x01, 0x65, 0x03, 0x04, 0x02, 0x01, 0x30,
            0x21, 0x03, 0x11, 0x00, 0xaa, 0xbb, 0xcc, 0xdd, 0xee, 0xff, 0x00, 0x11, 0x22, 0x33,
            0x44, 0x55, 0x66, 0xa1, 0x3c, 0xa0, 0x0e, 0x30, 0x0c, 0x06, 0x0a, 0x2b, 0x06, 0x01,
            0x04, 0x01, 0xb2, 0x31, 0x01, 0x0b, 0x02, 0x02, 0x01, 0x00, 0x00, 0x00,
        ]),
        expectedStatus: "GRANTED",
        hashAlgorithm: "SHA-256",
        includesCertificate: true,
        certificateChain: {
            count: 2,
            tsaSubject: "ADACOM Qualified TSA",
            tsaIssuer: "ADACOM Qualified CA",
            serialNumber: "aabbccddeeff001122",
            notBefore: "2024-01-01T00:00:00Z",
            notAfter: "2028-01-01T00:00:00Z",
        },
        sizeInfo: {
            totalBytes: 1178,
            tokenBytes: 860,
            certificateBytes: 1400,
        },
        quirks: ["Qualified EU TSA - EU eIDAS compliant"],
    },
};

/**
 * Helper function to get all fixture URLs for testing
 */
export function getAllFixtureUrls(): string[] {
    return Object.values(TSA_FIXTURES).map((f) => f.sourceUrl);
}

/**
 * Helper function to get fixtures by trust status
 */
export function getFixturesByTrustStatus(
    status: "QUALIFIED" | "TRUSTED" | "UNTRUSTED"
): TSAFixture[] {
    return Object.values(TSA_FIXTURES).filter((f) => f.trustStatus === status);
}

/**
 * Helper function to get fixtures by status
 */
export function getFixturesByStatus(
    status: "GRANTED" | "GRANTED_WITH_MODS" | "REJECTION" | "WAITING"
): TSAFixture[] {
    return Object.values(TSA_FIXTURES).filter((f) => f.expectedStatus === status);
}

/**
 * Get a fixture by name
 */
export function getFixtureByName(name: string): TSAFixture | undefined {
    return TSA_FIXTURES[name];
}
